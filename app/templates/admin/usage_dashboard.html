<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>LLM 使用量儀表板</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; padding: 24px; background: #f4f5f7; color: #111827; }
      h1 { margin-top: 0; font-size: 28px; }
      .filters { background: #fff; border-radius: 12px; padding: 16px 20px; box-shadow: 0 1px 3px rgba(15, 23, 42, 0.1); }
      .grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); margin: 20px 0; }
      .card { background: #fff; border-radius: 12px; padding: 14px; box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08); border: 1px solid rgba(148, 163, 184, 0.18); }
      .card h3 { margin: 0 0 4px; font-size: 14px; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
      .card .value { font-size: 24px; font-weight: 600; color: #111827; }
      label { font-weight: 600; font-size: 13px; margin-bottom: 4px; display: inline-block; }
      input, select { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
      button { background: #2563eb; color: white; border: none; border-radius: 8px; padding: 10px 16px; font-size: 14px; cursor: pointer; }
      button:hover { background: #1d4ed8; }
      button.secondary { background: #e2e8f0; color: #0f172a; }
      .actions { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 12px; }
      .table-wrapper { margin-top: 18px; overflow-x: auto; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.4); }
      table { width: 100%; border-collapse: collapse; min-width: 960px; }
      th, td { padding: 10px 12px; border-bottom: 1px solid #e2e8f0; font-size: 13px; }
      th { background: #f8fafc; text-align: left; color: #475569; font-size: 12px; letter-spacing: 0.05em; text-transform: uppercase; }
      tr:hover { background: rgba(37, 99, 235, 0.06); }
      .status { margin-top: 12px; font-size: 14px; color: #475569; }
      .status.success { color: #047857; }
      .status.error { color: #dc2626; }
      @media (prefers-color-scheme: dark) {
        body { background: #0f172a; color: #e2e8f0; }
        .filters, .card, .table-wrapper { background: rgba(15, 23, 42, 0.75); border-color: rgba(148, 163, 184, 0.25); }
        table { color: #e2e8f0; }
        th { background: rgba(30, 41, 59, 0.9); }
      }
    </style>
  </head>
  <body>
    <h1>LLM 使用量儀表板</h1>

    <section class="filters">
      <form id="filters">
        <div class="grid">
          <div>
            <label for="device">Device ID</label>
            <input id="device" name="device_id" type="text" placeholder="可選" />
          </div>
          <div>
            <label for="route">Route</label>
            <input id="route" name="route" type="text" placeholder="例如 /correct" />
          </div>
          <div>
            <label for="model">Model</label>
            <input id="model" name="model" type="text" placeholder="例如 gemini-pro" />
          </div>
          <div>
            <label for="provider">Provider</label>
            <input id="provider" name="provider" type="text" placeholder="例如 google" />
          </div>
          <div>
            <label for="since">開始時間</label>
            <input id="since" name="since" type="datetime-local" />
          </div>
          <div>
            <label for="until">結束時間</label>
            <input id="until" name="until" type="datetime-local" />
          </div>
          <div>
            <label for="limit">每頁筆數</label>
            <select id="limit" name="limit">
              <option value="50">50</option>
              <option value="100" selected>100</option>
              <option value="200">200</option>
            </select>
          </div>
        </div>
        <div class="actions">
          <button type="submit">查詢</button>
          <button type="button" id="resetBtn" class="secondary">重設</button>
          <button type="button" id="exportJson" class="secondary">匯出 JSON</button>
          <button type="button" id="prevBtn" class="secondary">上一頁</button>
          <button type="button" id="nextBtn" class="secondary">下一頁</button>
        </div>
      </form>
      <div id="status" class="status">尚未查詢。</div>
    </section>

    <section class="grid">
      <div class="card">
        <h3>總呼叫數</h3>
        <div class="value" id="sumCount">0</div>
      </div>
      <div class="card">
        <h3>Input Tokens</h3>
        <div class="value" id="sumInput">0</div>
      </div>
      <div class="card">
        <h3>Output Tokens</h3>
        <div class="value" id="sumOutput">0</div>
      </div>
      <div class="card">
        <h3>Total Tokens</h3>
        <div class="value" id="sumTotal">0</div>
      </div>
      <div class="card">
        <h3>平均延遲 (ms)</h3>
        <div class="value" id="sumLatency">0.00</div>
      </div>
      <div class="card">
        <h3>成本 (USD)</h3>
        <div class="value" id="sumCost">0.000000</div>
      </div>
    </section>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>時間</th>
            <th>Device</th>
            <th>Route</th>
            <th>Model</th>
            <th>Tokens (in/out/total)</th>
            <th>Latency (ms)</th>
            <th>Inline Parts</th>
            <th>Prompt Chars</th>
            <th>Status</th>
            <th>成本 (USD)</th>
            <th>Endpoint</th>
            <th>Detail</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <script type="module">
      import { initUsageDashboard } from '/static/js/usage-dashboard.js';
      initUsageDashboard();
    </script>
  </body>
</html>
