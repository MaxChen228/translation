<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>雲端課程內容管理</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; padding: 24px 32px 80px; background: #f8f9fb; color: #1f2933; }
    h1 { font-size: 28px; margin-bottom: 12px; }
    section { background: #fff; border-radius: 12px; padding: 20px 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08); }
    h2 { font-size: 20px; margin-top: 0; }
    label { display: block; font-weight: 600; margin: 8px 0 4px; }
    input[type="text"], input[type="url"], textarea, select { width: 100%; box-sizing: border-box; padding: 8px; border: 1px solid #cbd2d9; border-radius: 8px; font-size: 14px; background: #fff; }
    textarea { min-height: 160px; font-family: "SFMono-Regular", Menlo, Consolas, monospace; }
    button { background: #2563eb; border: none; color: white; padding: 10px 18px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #1d4ed8; }
    button:disabled { background: #a8b1c1; cursor: not-allowed; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .row > div { flex: 1; min-width: 240px; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 2px rgba(15,23,42,0.08); }
    th, td { border-bottom: 1px solid #e4e7eb; padding: 10px 12px; font-size: 13px; background: #fff; }
    th { background: #eff4fb; text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: 0.04em; color: #475569; }
    tr:last-child td { border-bottom: none; }
    .muted { color: #667085; font-size: 13px; }
    .status { margin-top: 8px; font-size: 14px; }
    .pill { display: inline-block; padding: 2px 8px; background: #e0ecff; color: #1d4ed8; border-radius: 9999px; font-size: 12px; margin: 2px 4px 2px 0; }
    .badge { display: inline-block; background: #e2e8f0; padding: 2px 6px; border-radius: 999px; font-size: 12px; margin-right: 6px; color: #334155; }
    .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 16px; }
    .card { background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 14px; box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.12); display: flex; flex-direction: column; gap: 6px; }
    .card h4 { margin: 0; font-size: 15px; color: #0f172a; }
    .card .subtitle { font-size: 13px; color: #475569; }
    .card footer { margin-top: 4px; font-size: 12px; color: #64748b; display: flex; justify-content: space-between; align-items: center; }
    .table-wrapper { overflow-x: auto; border-radius: 10px; box-shadow: 0 1px 2px rgba(15, 23, 42, 0.08); }
    .table-actions button { background: transparent; border: none; color: #2563eb; padding: 0; cursor: pointer; font-size: 12px; }
    .table-actions button:hover { text-decoration: underline; }
    .search-bar { display: flex; gap: 12px; margin-bottom: 14px; }
    .search-bar input { max-width: 260px; }
    .tag-filter { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
    .tag-filter button { background: #e0f2fe; color: #0369a1; padding: 6px 12px; border-radius: 999px; border: none; font-size: 12px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>雲端課程內容管理</h1>

  <section>
    <h2>步驟 0｜設定管理 Token</h2>
    <p class="muted">{{ '已在環境變數設定 Token，可直接使用。' if has_token else '後端未設定 CONTENT_ADMIN_TOKEN，任何人皆可操作。' }}</p>
    <label for="token-field">X-Content-Token</label>
    <input id="token-field" type="text" placeholder="輸入管理 token" />
    <button id="save-token-btn" style="margin-top:8px;">儲存 Token</button>
    <div id="token-status" class="status"></div>
  </section>

  <section>
    <h2>步驟 1｜編寫並上傳題庫本 (book)</h2>
    <p class="muted">先匯入 JSON 檔或直接在下方編輯，再送出上傳。</p>
    <div class="row">
      <div>
        <label for="book-file">匯入 JSON 檔 (選填)</label>
        <input id="book-file" type="file" accept="application/json" />
      </div>
      <div>
        <label for="book-filename">檔名 (不含副檔名)</label>
        <input id="book-filename" type="text" placeholder="例如 grammar-chapter1" />
      </div>
    </div>
    <label for="book-json">題庫本 JSON 內容</label>
    <textarea id="book-json" placeholder='{
  "id": "grammar-chapter1",
  "name": "Grammar Chapter 1",
  "items": [...]
}'></textarea>
    <button id="upload-book-btn" style="margin-top:10px;">上傳題庫本</button>
    <div id="book-status" class="status"></div>
  </section>

  <section>
    <h2>步驟 2｜組成課程 (course)</h2>
    <p class="muted">從右側題庫清單挑選並加入課程，可依需求覆蓋標題或標籤。</p>
    <form id="course-form">
      <label for="course-id">課程 ID</label>
      <input id="course-id" type="text" required placeholder="例如 grammar-essentials" />

      <label for="course-title">課程標題</label>
      <input id="course-title" type="text" required placeholder="顯示於 App 的標題" />

      <div class="row">
        <div>
          <label for="course-summary">課程摘要</label>
          <textarea id="course-summary" placeholder="課程簡介 (選填)" style="min-height:100px;"></textarea>
        </div>
        <div>
          <label for="course-cover">封面圖片 URL (選填)</label>
          <input id="course-cover" type="url" placeholder="https://..." />
          <label for="course-tags" style="margin-top:12px;">標籤 (以逗號分隔，可空白)</label>
          <input id="course-tags" type="text" placeholder="grammar, advanced" />
          <label for="book-catalog" style="margin-top:12px;">加入課程的題庫本</label>
          <select id="book-catalog"></select>
          <button type="button" id="add-book-btn" style="margin-top:8px;">加入課程書籍</button>
        </div>
      </div>

      <table id="selected-books-table" style="display:none;">
        <thead>
          <tr>
            <th style="width:180px;">課程書籍 ID</th>
            <th>來源題庫本</th>
            <th>顯示標題 (選填)</th>
            <th style="width:140px;">難度</th>
            <th style="width:120px;">操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <button type="submit" style="margin-top:16px;">儲存課程並發佈</button>
    </form>
    <div id="course-status" class="status"></div>
  </section>

  <section>
    <h2>現有課程與題庫概覽</h2>
    <div class="search-bar">
      <input id="book-search" type="text" placeholder="搜尋題庫 ID 或標題" />
      <input id="course-search" type="text" placeholder="搜尋課程 ID 或標題" />
    </div>
    <div class="row">
      <div>
        <h3>題庫本 (<span id="book-count">{{ books_count }}</span>)</h3>
        <div class="card-grid" id="book-summary-list"></div>
      </div>
      <div>
        <h3>課程 (<span id="course-count">{{ courses_count }}</span>)</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>課程 ID</th>
                <th>標題</th>
                <th>書籍數</th>
                <th>標籤</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="course-summary-list"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

    <script type="module">
    import { initContentAdminPage } from '/static/js/content-ui.js';

    initContentAdminPage({
      initialBooks: {{ books | tojson }},
      initialCourses: {{ courses | tojson }},
    });
  </script>

</body>
</html>
